<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hospital Management System</title>
  <style>
    /* (kept compact ‚Äî use your previous styles as needed) */
    * { margin:0; padding:0; box-sizing:border-box; }
    body{ font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg,#1a1a2e 0%,#16213e 50%,#0f3460 100%); padding:20px; min-height:100vh;}
    .container{ max-width:1200px; margin:0 auto; background:#fff; border-radius:16px; overflow:hidden; box-shadow:0 20px 60px rgba(0,0,0,0.45); }
    .header{ background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 50%,#ff006e 100%); color:#fff; padding:36px; text-align:center;}
    .nav{ display:flex; background:linear-gradient(135deg,#1a1a2e 0%,#16213e 100%); }
    .nav button{ flex:1; padding:16px; background:none; border:none; color:#00d2ff; cursor:pointer; font-weight:600; }
    .nav button.active{ background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 100%); color:#fff;}
    .content{ padding:28px; background:#f8f9fa;}
    .card{ background:#fff; padding:20px; border-radius:12px; margin-bottom:20px; box-shadow:0 8px 25px rgba(0,0,0,0.08); border-left:4px solid #00d2ff;}
    .table{ width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; }
    .table th, .table td{ padding:12px; border-bottom:1px solid #e6eef8; text-align:left;}
    .btn{ background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 100%); color:#fff; padding:10px 18px; border:none; border-radius:20px; cursor:pointer; }
    .btn-danger{ background:linear-gradient(135deg,#ff006e 0%,#ff4081 100%); padding:8px 14px; color:#fff; border:none; border-radius:14px; cursor:pointer;}
    .form-row{ display:grid; grid-template-columns:1fr 1fr; gap:12px; }
    @media(max-width:768px){ .form-row{ grid-template-columns:1fr; } .nav button{ width:100%; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üè• Hospital Management System</h1>
      <p>Firebase Connected</p>
    </div>

    <div class="nav">
      <button class="active" onclick="showSection('dashboard', event)">Dashboard</button>
      <button onclick="showSection('patients', event)">Patients</button>
      <button onclick="showSection('doctors', event)">Doctors</button>
      <button onclick="showSection('appointments', event)">Appointments</button>
      <button onclick="showSection('beds', event)">Beds</button>
      <button onclick="showSection('emergency', event)">Emergency</button>
    </div>

    <div class="content">
      <!-- DASHBOARD -->
      <div id="dashboard" class="section active">
        <div class="card">
          <h2>Dashboard</h2>
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px;">
            <div style="background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 50%,#ff006e 100%);color:#fff;padding:18px;border-radius:10px;text-align:center;">
              <h2 id="totalPatients">0</h2><p>Patients</p>
            </div>
            <div style="background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 50%,#ff006e 100%);color:#fff;padding:18px;border-radius:10px;text-align:center;">
              <h2 id="totalDoctors">0</h2><p>Doctors</p>
            </div>
            <div style="background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 50%,#ff006e 100%);color:#fff;padding:18px;border-radius:10px;text-align:center;">
              <h2 id="totalAppointments">0</h2><p>Appointments</p>
            </div>
            <div style="background:linear-gradient(135deg,#00d2ff 0%,#3a47d5 50%,#ff006e 100%);color:#fff;padding:18px;border-radius:10px;text-align:center;">
              <h2 id="availableBeds">50</h2><p>Available Beds</p>
            </div>
          </div>
        </div>
      </div>

      <!-- PATIENTS -->
      <div id="patients" class="section" style="display:none;">
        <div class="card">
          <h3>Add Patient</h3>
          <form id="patientForm">
            <div class="form-row">
              <div><label>Name</label><input id="patientName" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Age</label><input id="patientAge" type="number" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div class="form-row" style="margin-top:10px;">
              <div><label>Gender</label><select id="patientGender" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"><option value="">Select</option><option>Male</option><option>Female</option></select></div>
              <div><label>Contact</label><input id="patientContact" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div style="margin-top:12px;"><button class="btn" type="submit">Add Patient</button></div>
          </form>
        </div>

        <div class="card">
          <h3>Patient List</h3>
          <table class="table">
            <thead><tr><th>ID</th><th>Name</th><th>Age</th><th>Gender</th><th>Contact</th><th>Action</th></tr></thead>
            <tbody id="patientTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- DOCTORS -->
      <div id="doctors" class="section" style="display:none;">
        <div class="card">
          <h3>Add Doctor</h3>
          <form id="doctorForm">
            <div class="form-row">
              <div><label>Name</label><input id="doctorName" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Specialization</label><input id="doctorSpec" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div class="form-row" style="margin-top:10px;">
              <div><label>Contact</label><input id="doctorContact" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Email</label><input id="doctorEmail" type="email" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div style="margin-top:12px;"><button class="btn" type="submit">Add Doctor</button></div>
          </form>
        </div>

        <div class="card">
          <h3>Doctor List</h3>
          <table class="table">
            <thead><tr><th>ID</th><th>Name</th><th>Specialization</th><th>Contact</th><th>Email</th><th>Action</th></tr></thead>
            <tbody id="doctorTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- APPOINTMENTS -->
      <div id="appointments" class="section" style="display:none;">
        <div class="card">
          <h3>Book Appointment</h3>
          <form id="appointmentForm">
            <div class="form-row">
              <div><label>Patient Name</label><input id="appointmentPatient" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Doctor Name</label><input id="appointmentDoctor" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div class="form-row" style="margin-top:10px;">
              <div><label>Date</label><input id="appointmentDate" type="date" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Time</label><input id="appointmentTime" type="time" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div style="margin-top:12px;"><button class="btn" type="submit">Book</button></div>
          </form>
        </div>

        <div class="card">
          <h3>Appointment List</h3>
          <table class="table">
            <thead><tr><th>ID</th><th>Patient</th><th>Doctor</th><th>Date</th><th>Time</th><th>Action</th></tr></thead>
            <tbody id="appointmentTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- BEDS -->
      <div id="beds" class="section" style="display:none;">
        <div class="card">
          <h3>Allocate Bed</h3>
          <form id="bedForm">
            <div class="form-row">
              <div><label>Patient</label><input id="bedPatient" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Ward</label>
                <select id="bedWard" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px">
                  <option value="">Select</option><option>General</option><option>ICU</option><option>Emergency</option>
                </select>
              </div>
            </div>
            <div class="form-row" style="margin-top:10px;">
              <div><label>Bed Number</label><input id="bedNumber" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Admission Date</label><input id="bedAdmission" type="date" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div style="margin-top:12px;"><button class="btn" type="submit">Allocate</button></div>
          </form>
        </div>

        <div class="card">
          <h3>Bed List</h3>
          <table class="table">
            <thead><tr><th>Bed No</th><th>Patient</th><th>Ward</th><th>Admission</th><th>Action</th></tr></thead>
            <tbody id="bedTableBody"></tbody>
          </table>
        </div>
      </div>

      <!-- EMERGENCY -->
      <div id="emergency" class="section" style="display:none;">
        <div class="card">
          <h3>Register Emergency</h3>
          <form id="emergencyForm">
            <div class="form-row">
              <div><label>Patient</label><input id="emergencyPatient" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
              <div><label>Age</label><input id="emergencyAge" type="number" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px"></div>
            </div>
            <div class="form-row" style="margin-top:10px;">
              <div><label>Type</label>
                <select id="emergencyType" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px">
                  <option value="">Select</option><option>Accident</option><option>Heart Attack</option><option>Stroke</option>
                </select>
              </div>
              <div><label>Priority</label>
                <select id="emergencyPriority" required style="width:100%;padding:8px;border:1px solid #ddd;border-radius:8px">
                  <option value="">Select</option><option>Critical</option><option>High</option><option>Medium</option>
                </select>
              </div>
            </div>
            <div style="margin-top:12px;"><button class="btn" type="submit" style="background:linear-gradient(135deg,#ff006e 0%,#ff4081 100%);">Register</button></div>
          </form>
        </div>

        <div class="card">
          <h3>Emergency List</h3>
          <table class="table">
            <thead><tr><th>ID</th><th>Patient</th><th>Age</th><th>Type</th><th>Priority</th><th>Action</th></tr></thead>
            <tbody id="emergencyTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Main script (modular + realtime) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, deleteDoc, doc,
      onSnapshot, query, orderBy, serverTimestamp, getDocs
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    // --- Firebase config (yours) ---
    const firebaseConfig = {
      apiKey: "AIzaSyBR5NL_tt3lKTHr6arPLJp7AZPoimSFB88",
      authDomain: "hospital-management-e6fe1.firebaseapp.com",
      projectId: "hospital-management-e6fe1",
      storageBucket: "hospital-management-e6fe1.firebasestorage.app",
      messagingSenderId: "936798825339",
      appId: "1:936798825339:web:a2f8998c2a7576585babde"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // nav
    function showSection(id, ev) {
      document.querySelectorAll('.section').forEach(s => s.style.display = 'none');
      document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
      document.getElementById(id).style.display = 'block';
      if (ev && ev.target) ev.target.classList.add('active');
      updateDashboard();
    }
    window.showSection = showSection;

    const patientsCol = collection(db, "patients");
    const doctorsCol = collection(db, "doctors");
    const appointmentsCol = collection(db, "appointments");
    const bedsCol = collection(db, "beds");
    const emergenciesCol = collection(db, "emergencies");
    const totalBedsCap = 50;

    // Dashboard counts
    async function updateDashboard() {
      const [pSnap, dSnap, aSnap, bSnap] = await Promise.all([
        getDocs(patientsCol), getDocs(doctorsCol), getDocs(appointmentsCol), getDocs(bedsCol)
      ]);
      document.getElementById('totalPatients').textContent = pSnap.size;
      document.getElementById('totalDoctors').textContent = dSnap.size;
      document.getElementById('totalAppointments').textContent = aSnap.size;
      document.getElementById('availableBeds').textContent = totalBedsCap - bSnap.size;
    }

    // ---- PATIENTS ----
    document.getElementById('patientForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const patient = {
        name: document.getElementById('patientName').value.trim(),
        age: Number(document.getElementById('patientAge').value),
        gender: document.getElementById('patientGender').value,
        contact: document.getElementById('patientContact').value.trim(),
        createdAt: serverTimestamp()
      };
      await addDoc(patientsCol, patient);
      e.target.reset();
      alert('‚úÖ Patient added!');
    });

    onSnapshot(query(patientsCol, orderBy("createdAt", "desc")), snapshot => {
      const tbody = document.getElementById('patientTableBody');
      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:12px;">No patients</td></tr>';
      } else {
        tbody.innerHTML = snapshot.docs.map((docSnap, i) => {
          const p = { id: docSnap.id, ...docSnap.data() };
          return `<tr>
            <td>${i+1}</td>
            <td>${escapeHtml(p.name || '')}</td>
            <td>${p.age ?? ''}</td>
            <td>${escapeHtml(p.gender || '')}</td>
            <td>${escapeHtml(p.contact || '')}</td>
            <td><button class="btn-danger" onclick="deletePatient('${p.id}')">Delete</button></td>
          </tr>`;
        }).join('');
      }
      updateDashboard();
    });

    window.deletePatient = async (id) => {
      if (!confirm('Delete patient?')) return;
      await deleteDoc(doc(db, "patients", id));
    };

    // ---- DOCTORS ----
    document.getElementById('doctorForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const d = {
        name: document.getElementById('doctorName').value.trim(),
        specialization: document.getElementById('doctorSpec').value.trim(),
        contact: document.getElementById('doctorContact').value.trim(),
        email: document.getElementById('doctorEmail').value.trim(),
        createdAt: serverTimestamp()
      };
      await addDoc(doctorsCol, d);
      e.target.reset();
      alert('‚úÖ Doctor added!');
    });

    onSnapshot(query(doctorsCol, orderBy("createdAt", "desc")), snapshot => {
      const tbody = document.getElementById('doctorTableBody');
      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:12px;">No doctors</td></tr>';
      } else {
        tbody.innerHTML = snapshot.docs.map((docSnap, i) => {
          const d = { id: docSnap.id, ...docSnap.data() };
          return `<tr>
            <td>${i+1}</td>
            <td>${escapeHtml(d.name || '')}</td>
            <td>${escapeHtml(d.specialization || '')}</td>
            <td>${escapeHtml(d.contact || '')}</td>
            <td>${escapeHtml(d.email || '')}</td>
            <td><button class="btn-danger" onclick="deleteDoctor('${d.id}')">Delete</button></td>
          </tr>`;
        }).join('');
      }
      updateDashboard();
    });

    window.deleteDoctor = async (id) => {
      if (!confirm('Delete doctor?')) return;
      await deleteDoc(doc(db, "doctors", id));
    };

    // ---- APPOINTMENTS ----
    document.getElementById('appointmentForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const a = {
        patient: document.getElementById('appointmentPatient').value.trim(),
        doctor: document.getElementById('appointmentDoctor').value.trim(),
        date: document.getElementById('appointmentDate').value,
        time: document.getElementById('appointmentTime').value,
        createdAt: serverTimestamp()
      };
      await addDoc(appointmentsCol, a);
      e.target.reset();
      alert('‚úÖ Appointment booked!');
    });

    onSnapshot(query(appointmentsCol, orderBy("createdAt", "desc")), snapshot => {
      const tbody = document.getElementById('appointmentTableBody');
      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:12px;">No appointments</td></tr>';
      } else {
        tbody.innerHTML = snapshot.docs.map((docSnap, i) => {
          const a = { id: docSnap.id, ...docSnap.data() };
          return `<tr>
            <td>${i+1}</td>
            <td>${escapeHtml(a.patient || '')}</td>
            <td>${escapeHtml(a.doctor || '')}</td>
            <td>${escapeHtml(a.date || '')}</td>
            <td>${escapeHtml(a.time || '')}</td>
            <td><button class="btn-danger" onclick="deleteAppointment('${a.id}')">Cancel</button></td>
          </tr>`;
        }).join('');
      }
      updateDashboard();
    });

    window.deleteAppointment = async (id) => {
      if (!confirm('Cancel appointment?')) return;
      await deleteDoc(doc(db, "appointments", id));
    };

    // ---- BEDS ----
    document.getElementById('bedForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const c = await getDocs(bedsCol);
      if (c.size >= totalBedsCap) { alert('‚ùå No beds available!'); return; }
      const b = {
        bedNumber: document.getElementById('bedNumber').value.trim(),
        patient: document.getElementById('bedPatient').value.trim(),
        ward: document.getElementById('bedWard').value,
        admission: document.getElementById('bedAdmission').value,
        createdAt: serverTimestamp()
      };
      await addDoc(bedsCol, b);
      e.target.reset();
      alert('‚úÖ Bed allocated!');
    });

    onSnapshot(query(bedsCol, orderBy("createdAt", "desc")), snapshot => {
      const tbody = document.getElementById('bedTableBody');
      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;padding:12px;">No beds allocated</td></tr>';
      } else {
        tbody.innerHTML = snapshot.docs.map((docSnap) => {
          const b = { id: docSnap.id, ...docSnap.data() };
          return `<tr>
            <td>${escapeHtml(b.bedNumber || '')}</td>
            <td>${escapeHtml(b.patient || '')}</td>
            <td>${escapeHtml(b.ward || '')}</td>
            <td>${escapeHtml(b.admission || '')}</td>
            <td><button class="btn-danger" onclick="dischargeBed('${b.id}')">Discharge</button></td>
          </tr>`;
        }).join('');
      }
      updateDashboard();
    });

    window.dischargeBed = async (id) => {
      if (!confirm('Discharge bed?')) return;
      await deleteDoc(doc(db, "beds", id));
    };

    // ---- EMERGENCIES ----
    document.getElementById('emergencyForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const em = {
        patient: document.getElementById('emergencyPatient').value.trim(),
        age: Number(document.getElementById('emergencyAge').value),
        type: document.getElementById('emergencyType').value,
        priority: document.getElementById('emergencyPriority').value,
        createdAt: serverTimestamp()
      };
      await addDoc(emergenciesCol, em);
      e.target.reset();
      alert('üö® Emergency registered!');
    });

    onSnapshot(query(emergenciesCol, orderBy("createdAt", "desc")), snapshot => {
      const tbody = document.getElementById('emergencyTableBody');
      if (snapshot.empty) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;padding:12px;">No emergencies</td></tr>';
      } else {
        tbody.innerHTML = snapshot.docs.map((docSnap, i) => {
          const e = { id: docSnap.id, ...docSnap.data() };
          const color = (e.priority === 'Critical') ? '#ff006e' : '#00d2ff';
          return `<tr>
            <td>${i+1}</td>
            <td>${escapeHtml(e.patient || '')}</td>
            <td>${e.age ?? ''}</td>
            <td>${escapeHtml(e.type || '')}</td>
            <td style="color:${color};font-weight:bold;">${escapeHtml(e.priority || '')}</td>
            <td><button class="btn-danger" onclick="resolveEmergency('${e.id}')">Resolve</button></td>
          </tr>`;
        }).join('');
      }
      updateDashboard();
    });

    window.resolveEmergency = async (id) => {
      if (!confirm('Resolve emergency?')) return;
      await deleteDoc(doc(db, "emergencies", id));
    };

    // Small helper
    function escapeHtml(str) {
      if (!str && str !== 0) return '';
      return String(str).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'", "&#039;");
    }

    // initial load counts
    updateDashboard();
  </script>
</body>
</html>
